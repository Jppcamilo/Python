--------------------------------------------------------
-- 1. LIMPEZA TOTAL (Apaga tabelas antigas/erradas)
--------------------------------------------------------
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE CONVERSA_INDICA_CHALLENGE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE NIVEL_USUARIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE CONVERSA CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE CHALLENGE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE CURSO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE PROFESSOR CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE NIVEL CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE USUARIO CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL;
END;
/

--------------------------------------------------------
-- 2. CRIAÇÃO DAS TABELAS (DDL) - CORRIGIDO
--------------------------------------------------------

-- USUARIO
CREATE TABLE USUARIO (
    ID_USUARIO NUMBER NOT NULL,
    NOME_USUARIO VARCHAR2(100) NOT NULL,
    EMAIL_USUARIO VARCHAR2(100) NOT NULL,
    SENHA_USUARIO VARCHAR2(100) NOT NULL,
    PLANO_USUARIO VARCHAR2(50) NOT NULL
);
ALTER TABLE USUARIO ADD CONSTRAINT PK_USUARIO PRIMARY KEY (ID_USUARIO);
ALTER TABLE USUARIO ADD CONSTRAINT UQ_USUARIO_EMAIL UNIQUE (EMAIL_USUARIO);
ALTER TABLE USUARIO ADD CONSTRAINT CK_USUARIO_PLANO CHECK (PLANO_USUARIO IN ('BRONZE', 'PRATA', 'OURO'));

-- PROFESSOR
CREATE TABLE PROFESSOR (
    ID_PROFESSOR NUMBER NOT NULL,
    NOME_PROFESSOR VARCHAR2(100) NOT NULL,
    ESPECIALIDADE_PROFESSOR VARCHAR2(100) NOT NULL,
    EMAIL_PROFESSOR VARCHAR2(100) NOT NULL,
    SENHA_PROFESSOR VARCHAR2(100) NOT NULL
);
ALTER TABLE PROFESSOR ADD CONSTRAINT PK_PROFESSOR PRIMARY KEY (ID_PROFESSOR);
ALTER TABLE PROFESSOR ADD CONSTRAINT UQ_PROFESSOR_EMAIL UNIQUE (EMAIL_PROFESSOR);

-- CURSO
CREATE TABLE CURSO (
    ID_CURSO NUMBER NOT NULL,
    ID_PROFESSOR NUMBER NOT NULL,
    NOME_CURSO VARCHAR2(100) NOT NULL,
    DESCRICAO_CURSO VARCHAR2(255)
);
ALTER TABLE CURSO ADD CONSTRAINT PK_CURSO PRIMARY KEY (ID_CURSO);
ALTER TABLE CURSO ADD CONSTRAINT FK_CURSO_PROFESSOR FOREIGN KEY (ID_PROFESSOR) REFERENCES PROFESSOR (ID_PROFESSOR);

-- CHALLENGE
CREATE TABLE CHALLENGE (
    ID_CHALLENGE NUMBER NOT NULL,
    ID_USUARIO NUMBER NOT NULL,
    ID_CURSO NUMBER NOT NULL,
    NOME_CHALLENGE VARCHAR2(100) NOT NULL,
    DESCRICAO_CHALLENGE VARCHAR2(255) NOT NULL
);
ALTER TABLE CHALLENGE ADD CONSTRAINT PK_CHALLENGE PRIMARY KEY (ID_CHALLENGE);
ALTER TABLE CHALLENGE ADD CONSTRAINT FK_CHALLENGE_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID_USUARIO);
ALTER TABLE CHALLENGE ADD CONSTRAINT FK_CHALLENGE_CURSO FOREIGN KEY (ID_CURSO) REFERENCES CURSO (ID_CURSO);

-- CONVERSA (CORRIGIDO: VARCHAR2(10000) -> CLOB)
CREATE TABLE CONVERSA (
    ID_CONVERSA VARCHAR2(100) NOT NULL,
    ID_USUARIO NUMBER NOT NULL,
    DATA_HORA_CONVERSA DATE NOT NULL,
    CONTEUDO_CONVERSA CLOB NOT NULL 
);
ALTER TABLE CONVERSA ADD CONSTRAINT PK_CONVERSA PRIMARY KEY (ID_CONVERSA);
ALTER TABLE CONVERSA ADD CONSTRAINT FK_CONVERSA_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID_USUARIO);

-- CONVERSA_INDICA_CHALLENGE
CREATE TABLE CONVERSA_INDICA_CHALLENGE (
    ID_CONVERSA_INDICA_CHALLENGE NUMBER NOT NULL,
    ID_CONVERSA VARCHAR2(100) NOT NULL,
    ID_CHALLENGE NUMBER NOT NULL
);
ALTER TABLE CONVERSA_INDICA_CHALLENGE ADD CONSTRAINT PK_CONV_INDICA_CHALLENGE PRIMARY KEY (ID_CONVERSA_INDICA_CHALLENGE);
ALTER TABLE CONVERSA_INDICA_CHALLENGE ADD CONSTRAINT FK_CONV_INDICA_CONVERSA FOREIGN KEY (ID_CONVERSA) REFERENCES CONVERSA (ID_CONVERSA);
ALTER TABLE CONVERSA_INDICA_CHALLENGE ADD CONSTRAINT FK_CONV_INDICA_CHALLENGE FOREIGN KEY (ID_CHALLENGE) REFERENCES CHALLENGE (ID_CHALLENGE);

-- NIVEL
CREATE TABLE NIVEL (
    ID_NIVEL NUMBER NOT NULL,
    NOME_NIVEL VARCHAR2(100) NOT NULL,
    DESCRICAO_NIVEL VARCHAR2(255) NOT NULL
);
ALTER TABLE NIVEL ADD CONSTRAINT PK_NIVEL PRIMARY KEY (ID_NIVEL);

-- NIVEL_USUARIO
CREATE TABLE NIVEL_USUARIO (
    ID_USUARIO NUMBER NOT NULL,
    ID_NIVEL NUMBER NOT NULL,
    DATA_HORA_NIVEL DATE NOT NULL
);
ALTER TABLE NIVEL_USUARIO ADD CONSTRAINT FK_NIVEL_USUARIO_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID_USUARIO);
ALTER TABLE NIVEL_USUARIO ADD CONSTRAINT FK_NIVEL_USUARIO_NIVEL FOREIGN KEY (ID_NIVEL) REFERENCES NIVEL (ID_NIVEL);

--------------------------------------------------------
-- 3. INSERÇÃO DE DADOS (DML) - CORRIGIDO
--------------------------------------------------------
-- 1. Inserir o Usuário Admin (ID 99 para não misturar com os outros)
INSERT INTO USUARIO (ID_USUARIO, NOME_USUARIO, EMAIL_USUARIO, SENHA_USUARIO, PLANO_USUARIO)
VALUES (99, 'Administrador', 'admin@levelup.com', '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9', 'OURO');

-- 2. (Opcional) Definir o nível dele como Especialista para ficar bonito no menu
INSERT INTO NIVEL_USUARIO (ID_USUARIO, ID_NIVEL, DATA_HORA_NIVEL)
VALUES (99, 5, SYSDATE);

-- Usuários
INSERT INTO USUARIO VALUES (1, 'Ana Silva', 'ana1@email.com', '123456', 'BRONZE');
INSERT INTO USUARIO VALUES (2, 'Bruno Costa', 'bruno2@email.com', '123456', 'PRATA');
INSERT INTO USUARIO VALUES (3, 'Carla Souza', 'carla3@email.com', '123456', 'OURO');
INSERT INTO USUARIO VALUES (4, 'Daniel Rocha', 'daniel4@email.com', '123456', 'OURO');
INSERT INTO USUARIO VALUES (5, 'Elaine Melo', 'elaine5@email.com', '123456', 'PRATA');
INSERT INTO USUARIO VALUES (6, 'Fernando Lima', 'fernando6@email.com', '123456', 'BRONZE');
INSERT INTO USUARIO VALUES (7, 'Gabriela Pires', 'gabi7@email.com', '123456', 'OURO');
INSERT INTO USUARIO VALUES (8, 'Henrique Dias', 'henrique8@email.com', '123456', 'BRONZE');
INSERT INTO USUARIO VALUES (9, 'Isabela Ramos', 'isa9@email.com', '123456', 'PRATA');
INSERT INTO USUARIO VALUES (10, 'João Pedro', 'joao10@email.com', '123456', 'OURO');
INSERT INTO USUARIO VALUES (11, 'Karen Silva', 'karen11@email.com', '123456', 'BRONZE');
INSERT INTO USUARIO VALUES (12, 'Lucas Almeida', 'lucas12@email.com', '123456', 'PRATA');
INSERT INTO USUARIO VALUES (13, 'Mariana Souza', 'mari13@email.com', '123456', 'OURO');
INSERT INTO USUARIO VALUES (14, 'Nicolas Antunes', 'nico14@email.com', '123456', 'PRATA');
INSERT INTO USUARIO VALUES (15, 'Olivia Martins', 'oli15@email.com', '123456', 'BRONZE');


-- Professores (CORRIGIDO O TYPO NO ID 8)
INSERT INTO PROFESSOR VALUES (1, 'Prof. André', 'Java', 'andre@prof.com', '123345');
INSERT INTO PROFESSOR VALUES (2, 'Prof. Beatriz', 'Python', 'bia@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (3, 'Prof. Carlos', 'Banco de Dados', 'carlos@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (4, 'Prof. Diana', 'DevOps', 'diana@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (5, 'Prof. Eduardo', 'Redes', 'edu@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (6, 'Prof. Fernanda', 'Machine Learning', 'fer@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (7, 'Prof. Gustavo', 'JavaScript', 'gus@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (8, 'Prof. Helena', 'Cloud', 'helena@prof.com', '123'); -- Corrigido aqui
INSERT INTO PROFESSOR VALUES (9, 'Prof. Igor', 'C#', 'igor@prof.com', '123');
INSERT INTO PROFESSOR VALUES (10, 'Prof. Julia', 'Cibersegurança', 'julia@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (11, 'Prof. Kleber', 'IA', 'kleber@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (12, 'Prof. Larissa', 'Frontend', 'larissa@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (13, 'Prof. Marcelo', 'Backend', 'marcelo@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (14, 'Prof. Nathalia', 'AWS', 'nathalia@prof.com', '123456');
INSERT INTO PROFESSOR VALUES (15, 'Prof. Otávio', 'Oracle', 'otavio@prof.com', '123456');

-- Cursos
INSERT INTO CURSO VALUES (1,1,'Java Básico','Introdução ao Java');
INSERT INTO CURSO VALUES (2,2,'Python Básico','Primeiros passos com Python');
INSERT INTO CURSO VALUES (3,3,'Modelagem BD','Entidades e Relacionamentos');
INSERT INTO CURSO VALUES (4,4,'DevOps','Integração e Deploy contínuo');
INSERT INTO CURSO VALUES (5,5,'Redes 1','Fundamentos de redes');
INSERT INTO CURSO VALUES (6,6,'Machine Learning Intro','Conceitos iniciais de ML');
INSERT INTO CURSO VALUES (7,7,'JavaScript Moderno','ES6+');
INSERT INTO CURSO VALUES (8,8,'Cloud Básico', 'Princípios de cloud');
INSERT INTO CURSO VALUES (9,9,'C# básico','Introdução ao C#');
INSERT INTO CURSO VALUES (10,10,'Cyber Segurança','Fundamentos de segurança');
INSERT INTO CURSO VALUES (11,11,'IA Aplicada','IA no mundo real');
INSERT INTO CURSO VALUES (12,12,'Frontend','HTML, CSS, JS');
INSERT INTO CURSO VALUES (13,13,'Backend','APIs e serviços');
INSERT INTO CURSO VALUES (14,14,'AWS','Arquiteturas AWS');
INSERT INTO CURSO VALUES (15,15,'Oracle SQL','Consultas SQL');

-- Challenges
INSERT INTO CHALLENGE VALUES (1,1,1,'Desafio Java 1','Criar um Hello World');
INSERT INTO CHALLENGE VALUES (2,2,2,'Desafio Python 1','Criar calculadora');
INSERT INTO CHALLENGE VALUES (3,3,3,'Desafio BD 1','Criar modelo relacional');
INSERT INTO CHALLENGE VALUES (4,4,4,'Desafio DevOps 1','Criar pipeline simples');
INSERT INTO CHALLENGE VALUES (5,5,5,'Desafio Redes 1','Configurar IP');
INSERT INTO CHALLENGE VALUES (6,6,6,'Desafio ML 1','Criar regressão linear');
INSERT INTO CHALLENGE VALUES (7,7,7,'Desafio JS 1','Manipular DOM');
INSERT INTO CHALLENGE VALUES (8,8,8,'Desafio Cloud 1','Criar máquina virtual');
INSERT INTO CHALLENGE VALUES (9,9,9,'Desafio C# 1','Criar API simples');
INSERT INTO CHALLENGE VALUES (10,10,10,'Desafio Cyber 1','Identificar vulnerabilidade');
INSERT INTO CHALLENGE VALUES (11,11,11,'Desafio IA 1','Criar modelo de classificação');
INSERT INTO CHALLENGE VALUES (12,12,12,'Desafio Front 1','Criar landing page');
INSERT INTO CHALLENGE VALUES (13,13,13,'Desafio Back 1','Criar CRUD completo');
INSERT INTO CHALLENGE VALUES (14,14,14,'Desafio AWS 1','Criar bucket S3');
INSERT INTO CHALLENGE VALUES (15,15,15,'Desafio Oracle 1','Criar tabela SQL');

-- Conversas (Agora vai funcionar!)
INSERT INTO CONVERSA VALUES ('C1',1, SYSDATE,'Conversa sobre desafios.');
INSERT INTO CONVERSA VALUES ('C2',2, SYSDATE,'Início da conversa.');
INSERT INTO CONVERSA VALUES ('C3',3, SYSDATE,'Dúvidas sobre curso.');
INSERT INTO CONVERSA VALUES ('C4',4, SYSDATE,'Feedback do sistema.');
INSERT INTO CONVERSA VALUES ('C5',5, SYSDATE,'Erro ao acessar.');
INSERT INTO CONVERSA VALUES ('C6',6, SYSDATE,'Ajuda com ML.');
INSERT INTO CONVERSA VALUES ('C7',7, SYSDATE,'Novo desafio.');
INSERT INTO CONVERSA VALUES ('C8',8, SYSDATE,'Indicação de desafio.');
INSERT INTO CONVERSA VALUES ('C9',9, SYSDATE,'Mensagem geral.');
INSERT INTO CONVERSA VALUES ('C10',10, SYSDATE,'Olá!');
INSERT INTO CONVERSA VALUES ('C11',11, SYSDATE,'Perguntas gerais.');
INSERT INTO CONVERSA VALUES ('C12',12, SYSDATE,'Requisição.');
INSERT INTO CONVERSA VALUES ('C13',13, SYSDATE,'Aviso importante.');
INSERT INTO CONVERSA VALUES ('C14',14, SYSDATE,'Boa tarde!');
INSERT INTO CONVERSA VALUES ('C15',15, SYSDATE,'Preciso de ajuda.');

-- Conversa Indica Challenge
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (1,'C1',1);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (2,'C2',2);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (3,'C3',3);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (4,'C4',4);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (5,'C5',5);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (6,'C6',6);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (7,'C7',7);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (8,'C8',8);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (9,'C9',9);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (10,'C10', 10);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (11,'C11', 11);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (12,'C12',12);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (13,'C13', 13);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (14,'C14',14);
INSERT INTO CONVERSA_INDICA_CHALLENGE VALUES (15,'C15',15);

-- Niveis
INSERT INTO NIVEL VALUES (1,'Iniciante','Começando agora');
INSERT INTO NIVEL VALUES (2,'Aprendiz','Primeiros passos');
INSERT INTO NIVEL VALUES (3,'Intermediário','Entendendo conceitos');
INSERT INTO NIVEL VALUES (4,'Avançado','Alta proficiência');
INSERT INTO NIVEL VALUES (5,'Especialista','Domina o tema');
INSERT INTO NIVEL VALUES (6,'Bronze','Nível bronzeado');
INSERT INTO NIVEL VALUES (7,'Prata','Nível prata');
INSERT INTO NIVEL VALUES (8,'Ouro','Nível ouro');
INSERT INTO NIVEL VALUES (9,'Platina','Nível platina');
INSERT INTO NIVEL VALUES (10,'Diamante','Nível diamante');
INSERT INTO NIVEL VALUES (11,'Master','Nível mestre');
INSERT INTO NIVEL VALUES (12,'Pro','Nível profissional');
INSERT INTO NIVEL VALUES (13,'Elite','Nível elite');
INSERT INTO NIVEL VALUES (14,'Supremo','Nível supremo');
INSERT INTO NIVEL VALUES (15,'Lendário','Nível lendário');

-- Nivel Usuario
INSERT INTO NIVEL_USUARIO VALUES (1,1,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (2,2,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (3,3,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (4,4,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (5,5,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (6,6,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (7,7,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (8,8,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (9,9,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (10,10,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (11,11, SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (12,12,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (13,13,SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (14,14, SYSDATE);
INSERT INTO NIVEL_USUARIO VALUES (15,15, SYSDATE);

COMMIT;